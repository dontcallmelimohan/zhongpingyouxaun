<!DOCTYPE html>

<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>众评优选 | 仪表盘</title>
<link href="../libs/bootstrap/5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="../libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet"/>
<link href="../libs/admin-lte/3.2.0/dist/css/adminlte.min.css" rel="stylesheet"/>
<link href="css/admin.css" rel="stylesheet"/>
</head>
<body class="hold-transition sidebar-mini layout-fixed">
<div class="wrapper">
<nav class="main-header navbar navbar-expand navbar-white navbar-light">
<ul class="navbar-nav">
<li class="nav-item">
<a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
</li>
</ul>
<ul class="navbar-nav ml-auto">
<li class="nav-item">
<a class="nav-link" href="/index.html" role="button">
<i class="fas fa-home mr-1"></i> 返回首页
      </a>
</li>
<li class="nav-item">
<a class="nav-link" href="#" id="logoutButton" role="button">
<i class="fas fa-sign-out-alt"></i> 退出登录
      </a>
</li>
</ul>
</nav>
<aside class="main-sidebar sidebar-dark-primary elevation-4">
<a class="brand-link" href="index.html">
<img alt="AdminLTE Logo" class="brand-image img-circle elevation-3" src="img/AdminLTELogo.png" style="opacity: .8"/>
<span class="brand-text font-weight-light">众评优选后台</span>
</a>
<div class="sidebar">
<div class="user-panel mt-3 pb-3 mb-3 d-flex">
<div class="info">
<a class="d-block" href="#" id="sidebar-username">正在加载...</a>
</div>
</div>
<nav class="mt-2">
<ul class="nav nav-pills nav-sidebar flex-column" data-accordion="false" data-widget="treeview" role="menu">
<li class="nav-item">
<a class="nav-link active" href="index.html">
<i class="nav-icon fas fa-tachometer-alt"></i>
<p>仪表盘</p>
</a>
</li>
<li class="nav-header">内容管理</li>
<li class="nav-item">
<a class="nav-link" href="carousels.html">
<i class="nav-icon fas fa-images"></i>
<p>轮播图管理</p>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="products.html">
<i class="nav-icon fas fa-box"></i>
<p>商品管理</p>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="reviews.html">
<i class="nav-icon fas fa-comments"></i>
<p>评价管理</p>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="users.html">
<i class="nav-icon fas fa-users"></i>
<p>用户管理</p>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="categories.html">
<i class="nav-icon fas fa-tags"></i>
<p>分类管理</p>
</a>
</li>
<li class="nav-item">
<a class="nav-link" href="merchants.html">
<i class="nav-icon fas fa-store"></i>
<p>商家管理</p>
</a>
</li>
</ul>
</nav>
</div>
</aside>
<div class="content-wrapper">
<div class="content-header">
<div class="container-fluid">
<div class="row mb-2">
<div class="col-sm-6">
<h1 class="m-0">仪表盘</h1>
</div>
</div>
</div>
</div>
<section class="content">
<div class="container-fluid">
<div class="row">
<div class="col-12 col-sm-6 col-md-3">
<div class="info-box dashboard-card">
<span class="info-box-icon bg-info"><i class="fas fa-users stat-icon"></i></span>
<div class="info-box-content">
<span class="info-box-text">总用户数</span>
<span class="info-box-number stat-number" id="total-users">--</span>
<span class="info-box-desc">注册用户总数</span>
</div>
</div>
</div>
<div class="col-12 col-sm-6 col-md-3">
<div class="info-box dashboard-card">
<span class="info-box-icon bg-success"><i class="fas fa-box stat-icon"></i></span>
<div class="info-box-content">
<span class="info-box-text">总商品数</span>
<span class="info-box-number stat-number" id="total-products">--</span>
<span class="info-box-desc">上架商品总数</span>
</div>
</div>
</div>
<div class="col-12 col-sm-6 col-md-3">
<div class="info-box dashboard-card">
<span class="info-box-icon bg-warning"><i class="fas fa-comments stat-icon"></i></span>
<div class="info-box-content">
<span class="info-box-text">总评价数</span>
<span class="info-box-number stat-number" id="total-reviews">--</span>
<span class="info-box-desc">用户评价总数</span>
</div>
</div>
</div>
<div class="col-12 col-sm-6 col-md-3">
<div class="info-box dashboard-card">
<span class="info-box-icon bg-purple"><i class="fas fa-chart-line stat-icon"></i></span>
<div class="info-box-content">
<span class="info-box-text">今日访问</span>
<span class="info-box-number stat-number" id="today-visits">--</span>
<span class="info-box-desc">今日访问量</span>
</div>
</div>
</div>
</div>
<div class="row mt-4">
<div class="col-12">
<div class="card">
<div class="card-header">
<h3 class="card-title">
<i class="fas fa-bolt mr-2"></i>快速操作
                </h3>
</div>
<div class="card-body">
<div class="row">
<div class="col-md-3 col-sm-6 col-12">
<a class="btn btn-app" href="users.html">
<i class="fas fa-users fa-2x"></i>
                      用户管理
                    </a>
</div>
<div class="col-md-3 col-sm-6 col-12">
<a class="btn btn-app" href="products.html">
<i class="fas fa-box fa-2x"></i>
                      商品管理
                    </a>
</div>
<div class="col-md-3 col-sm-6 col-12">
<a class="btn btn-app" href="reviews.html">
<i class="fas fa-comments fa-2x"></i>
                      评价管理
                    </a>
</div>
<div class="col-md-3 col-sm-6 col-12">
<a class="btn btn-app" href="carousels.html">
<i class="fas fa-images fa-2x"></i>
                      轮播图管理
                    </a>
</div>
<div class="col-md-3 col-sm-6 col-12">
<a class="btn btn-app" href="categories.html">
<i class="fas fa-tags fa-2x"></i>
                      分类管理
                    </a>
</div>
<div class="col-md-3 col-sm-6 col-12">
<a class="btn btn-app" href="merchants.html">
<i class="fas fa-store fa-2x"></i>
                      商家管理
                    </a>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</div>
</div>
<script src="../libs/jquery/3.7.1/dist/jquery.min.js"></script>
<script src="../libs/bootstrap/5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="../libs/admin-lte/3.2.0/dist/js/adminlte.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const token = localStorage.getItem('jwtToken');
    if (!token) {

      window.location.href = 'login.html';
      return;
    }

    const user = JSON.parse(localStorage.getItem('user'));
    if (!user) {

      window.location.href = 'login.html';
      return;
    }


    if (!user.roles || !user.roles.includes('ROLE_ADMIN')) {

      alert('您无权访问管理后台！只有管理员可以进入。');

      setTimeout(() => {
        window.location.href = '/index.html';
      }, 500);
      return;
    }


    if (user.username) {
      document.getElementById('sidebar-username').textContent = user.username;
    }


    document.getElementById('logoutButton').addEventListener('click', () => {
      localStorage.removeItem('jwtToken');
      localStorage.removeItem('user');
      window.location.href = 'login.html';
    });


    async function fetchStats() {
      try {
        const headers = { 'Authorization': `Bearer ${token}` };
        

        const [usersResponse, productsResponse, reviewsResponse] = await Promise.all([
          fetch('http://localhost:8080/api/admin/users?size=1', { headers }),
          fetch('http://localhost:8080/api/products?size=1', { headers }),
          fetch('http://localhost:8080/api/reviews?size=1', { headers })
        ]);

        if(usersResponse.ok) {
          const usersData = await usersResponse.json();
          document.getElementById('total-users').textContent = usersData.totalElements.toLocaleString();
        }
        
        if(productsResponse.ok) {
          const productsData = await productsResponse.json();
          document.getElementById('total-products').textContent = productsData.totalElements.toLocaleString();
        }
        
        if(reviewsResponse.ok) {
          const reviewsData = await reviewsResponse.json();
          document.getElementById('total-reviews').textContent = reviewsData.totalElements.toLocaleString();
        }
        

        document.getElementById('today-visits').textContent = Math.floor(Math.random() * 1000 + 500).toLocaleString();
        
      } catch (error) {
        console.error("Failed to fetch stats:", error);

        document.getElementById('total-users').textContent = '0';
        document.getElementById('total-products').textContent = '0';
        document.getElementById('total-reviews').textContent = '0';
        document.getElementById('today-visits').textContent = '0';
      }
    }


    function showLoading() {
      $('.stat-number').addClass('text-muted');
    }

    function hideLoading() {
      $('.stat-number').removeClass('text-muted');
    }


    async function initPage() {
      showLoading();
      await fetchStats();
      hideLoading();
      

      $('.dashboard-card').hover(
        function() { $(this).addClass('shadow-lg'); },
        function() { $(this).removeClass('shadow-lg'); }
      );
    }

    initPage();
  });
</script>
</body>
</html>